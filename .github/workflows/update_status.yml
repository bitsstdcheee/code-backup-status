name: 更新统计信息
env:
    TOKEN: ${{ secrets.TOKEN }}
on:
    workflow_dispatch:
    workflow_call:
jobs:
    update_status_information:
        name: 更新统计信息
        runs-on: ubuntu-latest
        steps:
          - name: 克隆仓库 (bitsstdcheee/code-backup)
            uses: actions/checkout@v2
            with:
              repository: bitsstdcheee/code-backup
              ref: main
              path: code-backup
              token: ${{ env.TOKEN }}
              fetch-depth: 1
          - name: 克隆仓库 (本仓库)
            uses: actions/checkout@v2
            with:
                fetch-depth: 1
                path: status
          - name: 编译
            run: |
                g++ status/main.cpp -o status/main
          - name: 运行
            run: |
                ./status/main > output.txt
          - name: 输出结果
            if: always()
            run: |
                cat output.txt
          - name: 上传构件
            if: always()
            uses: actions/upload-artifact@v2
            with:
              name: code
              path: .
